<!DOCTYPE html>
<html>

<head>
    <title>Test marked-highlight Integration</title>
    <link rel="stylesheet" href="static/vendor/github.min.css">
    <script src="static/vendor/marked.min.js"></script>
    <script src="static/vendor/marked-highlight.min.js"></script>
    <script src="static/vendor/highlight.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        .test-section {
            margin: 20px 0;
            border: 1px solid #ddd;
            padding: 20px;
        }

        .result {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1>Test marked-highlight Integration</h1>

    <div class="test-section">
        <h2>Test 1: JavaScript Code Block</h2>
        <div id="test1-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Python Code Block</h2>
        <div id="test2-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: HTML Code Block</h2>
        <div id="test3-result" class="result"></div>
    </div>

    <script>
        // Initialize highlight.js
        if (typeof hljs !== 'undefined') {
            hljs.configure({
                ignoreUnescapedHTML: true,
                languages: ['javascript', 'python', 'html', 'css', 'json', 'bash', 'go', 'java', 'cpp', 'sql']
            });
        }

        // Initialize marked with marked-highlight
        let markedInstance = null;
        if (typeof marked !== 'undefined' && typeof markedHighlight !== 'undefined') {
            markedInstance = new marked.Marked(
                markedHighlight.markedHighlight({
                    langPrefix: 'hljs language-',
                    highlight(code, lang) {
                        if (typeof hljs !== 'undefined') {
                            const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                            return hljs.highlight(code, { language }).value;
                        }
                        return code;
                    }
                })
            );

            markedInstance.setOptions({
                breaks: true,
                gfm: true,
                headerIds: false,
                mangle: false
            });
        }

        // Test cases
        const test1 = `\`\`\`javascript
function hello() {
    console.log('Hello, world!');
    const message = "This is a test";
    return message;
}
\`\`\``;

        const test2 = `\`\`\`python
def hello_world():
    """Print hello world message"""
    message = "Hello, world!"
    print(message)
    return True
\`\`\``;

        const test3 = `\`\`\`html
<!DOCTYPE html>
<html>
<head>
    <title>Test Page</title>
</head>
<body>
    <h1>Hello World</h1>
    <p>This is a test page.</p>
</body>
</html>
\`\`\``;

        // Run tests
        if (markedInstance) {
            document.getElementById('test1-result').innerHTML = markedInstance.parse(test1);
            document.getElementById('test2-result').innerHTML = markedInstance.parse(test2);
            document.getElementById('test3-result').innerHTML = markedInstance.parse(test3);

            console.log('✅ marked-highlight integration working correctly');
        } else {
            document.body.innerHTML += '<div style="color: red; font-weight: bold;">❌ marked-highlight integration failed to initialize</div>';
            console.error('❌ marked-highlight integration failed');
        }
    </script>
</body>

</html>
